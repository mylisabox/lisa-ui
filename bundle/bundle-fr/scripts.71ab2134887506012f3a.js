!function(t,e,n,r){e[t]=(function(){var t=function t(e,n,r){function i(s,c){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){return i(e[s][1][t]||t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";e.exports=function(t,e){var n=/[, ]+/;function r(t,r){if(e[t]){if("string"==typeof e[t]&&(e[t]=e[t].split(n)),"function"==typeof e[t])return e[t].call(r);for(var i,o,s=0;s<e[t].length;s++)"function"==(i=typeof(o=e[t][s]))?o.call(r):"string"===i&&"function"==typeof r[o]&&r[o]()}}return e=e||{},"string"==typeof(t=t||[])&&(t=t.split(n)),function(){var e,n=0;if(null===this[t[0]])return!1;for(r("before",this);n<t.length;n++)this[e=t[n]]&&("function"==typeof this[e].destroy&&this[e].destroy(),this[e]=null);return this.emit&&this.emit("destroy"),r("after",this),!0}}},{}],2:[function(t,e,n){"use strict";e.exports=function(){for(var t,e=this,n=0,r=arguments.length,i=new Array(r);n<r;n++)i[n]=arguments[n];return"function"!=typeof i[i.length-1]?function(){for(var t=0,n=arguments.length,r=new Array(n);t<n;t++)r[t]=arguments[t];return e.emit.apply(e,i.concat(r))}:(t=i.pop(),function(){for(var n=0,r=arguments.length,o=new Array(r+1);n<r;n++)o[n+1]=arguments[n];return o[0]=function(t,n){if(t)return e.emit("error",t);o=void 0===n?o.slice(1):null===n?[]:n,e.emit.apply(e,i.concat(o))},t.apply(e,o),!0})}},{}],3:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="function"!=typeof Object.create&&"~";function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(){}s.prototype._events=void 0,s.prototype.eventNames=function(){var t,e=this._events,n=[];if(!e)return n;for(t in e)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(t,e){var n=this._events&&this._events[i?i+t:t];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,s=new Array(o);r<o;r++)s[r]=n[r].fn;return s},s.prototype.emit=function(t,e,n,r,o,s){var c=i?i+t:t;if(!this._events||!this._events[c])return!1;var a,u,f=this._events[c],p=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,r),!0;case 5:return f.fn.call(f.context,e,n,r,o),!0;case 6:return f.fn.call(f.context,e,n,r,o,s),!0}for(u=1,a=new Array(p-1);u<p;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var h,l=f.length;for(u=0;u<l;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),p){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,n);break;default:if(!a)for(h=1,a=new Array(p-1);h<p;h++)a[h-1]=arguments[h];f[u].fn.apply(f[u].context,a)}}return!0},s.prototype.on=function(t,e,n){var r=new o(e,n||this),s=i?i+t:t;return this._events||(this._events=i?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):this._events[s]=r,this},s.prototype.once=function(t,e,n){var r=new o(e,n||this,!0),s=i?i+t:t;return this._events||(this._events=i?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):this._events[s]=r,this},s.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events||!this._events[o])return this;var s=this._events[o],c=[];if(e)if(s.fn)(s.fn!==e||r&&!s.once||n&&s.context!==n)&&c.push(s);else for(var a=0,u=s.length;a<u;a++)(s[a].fn!==e||r&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);return c.length?this._events[o]=1===c.length?c[0]:c:delete this._events[o],this},s.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[i?i+t:t]:this._events=i?{}:Object.create(null),this):this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=i,void 0!==e&&(e.exports=s)},{}],4:[function(t,e,n){"use strict";var r=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i");e.exports=function(t){var e,n,i=typeof t;if("number"===i)return t;if("string"!==i||"0"===t||!t)return 0;if(+t)return+t;if(t.length>1e4||!(n=r.exec(t)))return 0;switch(e=parseFloat(n[1]),n[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*e;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;default:return e}}},{}],5:[function(t,e,n){"use strict";e.exports=function(t){var e,n=0;function r(){return n?e:(n=1,e=t.apply(this,arguments),t=null,e)}return r.displayName=t.displayName||t.name||r.displayName||r.name,r}},{}],6:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty;n.stringify=function(t,e){e=e||"";var n=[];for(var i in"string"!=typeof e&&(e="?"),t)r.call(t,i)&&n.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return n.length?e+n.join("&"):""},n.parse=function(t){for(var e,n=/([^=?&]+)=([^&]*)/g,r={};e=n.exec(t);r[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return r}},{}],7:[function(t,e,n){"use strict";var r=t("eventemitter3"),i=t("millisecond"),o=t("demolish"),s=t("tick-tock"),c=t("one-time");function a(t,e,n){return i(t in n?n[t]:t in e?e[t]:u[t])}function u(t){if(!(this instanceof u))return new u(t);t=t||{},this.attempt=null,this._fn=null,this["reconnect timeout"]=a("reconnect timeout",this,t),this.retries=a("retries",this,t),this.factor=a("factor",this,t),this.max=a("max",this,t),this.min=a("min",this,t),this.timers=new s(this)}(u.prototype=new r).constructor=u,u["reconnect timeout"]="30 seconds",u.max=1/0,u.min="500 ms",u.retries=10,u.factor=2,u.prototype.reconnect=function(){var t=this;return t.backoff(function(e,n){if(n.duration=+new Date-n.start,e)return t.emit("reconnect failed",e,n);t.emit("reconnected",n)},t.attempt)},u.prototype.backoff=function(t,e){var n=this;return(e=e||n.attempt||{}).backoff?n:(e["reconnect timeout"]=a("reconnect timeout",n,e),e.retries=a("retries",n,e),e.factor=a("factor",n,e),e.max=a("max",n,e),e.min=a("min",n,e),e.start=+e.start||+new Date,e.duration=+e.duration||0,e.attempt=+e.attempt||0,e.attempt===e.retries?(t.call(n,new Error("Unable to recover"),e),n):(e.backoff=!0,e.attempt++,n.attempt=e,e.scheduled=1!==e.attempt?Math.min(Math.round((Math.random()+1)*e.min*Math.pow(e.factor,e.attempt-1)),e.max):e.min,n.timers.setTimeout("reconnect",function(){e.duration=+new Date-e.start,e.backoff=!1,n.timers.clear("reconnect, timeout");var r=n._fn=c(function(r){if(n.reset(),r)return n.backoff(t,e);t.call(n,void 0,e)});n.emit("reconnect",e,r),n.timers.setTimeout("timeout",function(){var t=new Error("Failed to reconnect in a timely manner");e.duration=+new Date-e.start,n.emit("reconnect timeout",t,e),r(t)},e["reconnect timeout"])},e.scheduled),n.emit("reconnect scheduled",e),n))},u.prototype.reconnecting=function(){return!!this.attempt},u.prototype.reconnected=function(t){return this._fn&&this._fn(t),this},u.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},u.prototype.destroy=o("timers attempt _fn"),e.exports=u},{demolish:1,eventemitter3:8,millisecond:4,"one-time":5,"tick-tock":10}],8:[function(t,e,n){"use strict";var r="function"!=typeof Object.create&&"~";function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){}o.prototype._events=void 0,o.prototype.listeners=function(t,e){var n=this._events&&this._events[r?r+t:t];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s},o.prototype.emit=function(t,e,n,i,o,s){var c=r?r+t:t;if(!this._events||!this._events[c])return!1;var a,u,f=this._events[c],p=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,i),!0;case 5:return f.fn.call(f.context,e,n,i,o),!0;case 6:return f.fn.call(f.context,e,n,i,o,s),!0}for(u=1,a=new Array(p-1);u<p;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var h,l=f.length;for(u=0;u<l;u++)switch(f[u].once&&this.removeListener(t,f[u].fn,void 0,!0),p){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,e);break;case 3:f[u].fn.call(f[u].context,e,n);break;default:if(!a)for(h=1,a=new Array(p-1);h<p;h++)a[h-1]=arguments[h];f[u].fn.apply(f[u].context,a)}}return!0},o.prototype.on=function(t,e,n){var o=new i(e,n||this),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):this._events[s]=o,this},o.prototype.once=function(t,e,n){var o=new i(e,n||this,!0),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):this._events[s]=o,this},o.prototype.removeListener=function(t,e,n,i){var o=r?r+t:t;if(!this._events||!this._events[o])return this;var s=this._events[o],c=[];if(e)if(s.fn)(s.fn!==e||i&&!s.once||n&&s.context!==n)&&c.push(s);else for(var a=0,u=s.length;a<u;a++)(s[a].fn!==e||i&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);return c.length?this._events[o]=1===c.length?c[0]:c:delete this._events[o],this},o.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[r?r+t:t]:this._events=r?{}:Object.create(null),this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=r,void 0!==e&&(e.exports=o)},{}],9:[function(t,e,n){"use strict";e.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}],10:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i=t("millisecond");function o(t,e,n,r){this.start=+new Date,this.duration=n,this.clear=e,this.timer=t,this.fns=[r]}function s(t){clearTimeout(t)}function c(t){clearInterval(t)}function a(t){clearImmediate(t)}function u(t){if(!(this instanceof u))return new u(t);this.timers={},this.context=t||this}o.prototype.remaining=function(){return this.duration-this.taken()},o.prototype.taken=function(){return+new Date-this.start},u.prototype.tock=function(t,e){var n=this;return function(){if(t in n.timers){var r=n.timers[t].fns.slice(),i=r.length,o=0;for(e?n.clear(t):n.start=+new Date;o<i;o++)r[o].call(n.context)}}},u.prototype.setTimeout=function(t,e,n){var r;return this.timers[t]?(this.timers[t].fns.push(e),this):(r=i(n),this.timers[t]=new o(setTimeout(this.tock(t,!0),i(n)),s,r,e),this)},u.prototype.setInterval=function(t,e,n){var r;return this.timers[t]?(this.timers[t].fns.push(e),this):(r=i(n),this.timers[t]=new o(setInterval(this.tock(t),i(n)),c,r,e),this)},u.prototype.setImmediate=function(t,e){return"function"!=typeof setImmediate?this.setTimeout(t,e,0):this.timers[t]?(this.timers[t].fns.push(e),this):(this.timers[t]=new o(setImmediate(this.tock(t,!0)),a,0,e),this)},u.prototype.active=function(t){return t in this.timers},u.prototype.clear=function(){var t,e,n,i=arguments.length?arguments:[];if(1===i.length&&"string"==typeof i[0]&&(i=i[0].split(/[, ]+/)),!i.length)for(t in this.timers)r.call(this.timers,t)&&i.push(t);for(e=0,n=i.length;e<n;e++)(t=this.timers[i[e]])&&(t.clear(t.timer),t.fns=t.timer=t.clear=null,delete this.timers[i[e]]);return this},u.prototype.adjust=function(t,e){var n,r=i(e),o=this.timers[t];return o?(n=o.clear===c,o.clear(o.timer),o.start=+new Date,o.duration=r,o.timer=(n?setInterval:setTimeout)(this.tock(t,!n),r),this):this},u.prototype.end=u.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},u.Timer=o,e.exports=u},{millisecond:4}],11:[function(t,e,n){"use strict";var r=t("requires-port"),i=t("./lolcation"),o=t("querystringify"),s=/^\/(?!\/)/,c=/^([a-z0-9.+-]+:)?(\/\/)?(.*)$/i,a=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];function u(t,e,n){if(!(this instanceof u))return new u(t,e,n);var f,p,h,l,m=s.test(t),d=typeof e,y=this,v=0;"object"!==d&&"string"!==d&&(n=e,e=null),n&&"function"!=typeof n&&(n=o.parse),e=i(e);var g=function(t){var e=c.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]?e[3]:""}}(t);for(y.protocol=g.protocol||e.protocol||"",y.slashes=g.slashes||e.slashes,t=g.rest;v<a.length;v++)l=(p=a[v])[1],(f=p[0])!=f?y[l]=t:"string"==typeof f?~(h=t.indexOf(f))&&("number"==typeof p[2]?(y[l]=t.slice(0,h),t=t.slice(h+p[2])):(y[l]=t.slice(h),t=t.slice(0,h))):(h=f.exec(t))&&(y[l]=h[1],t=t.slice(0,t.length-h[0].length)),y[l]=y[l]||(p[3]||"port"===l&&m)&&e[l]||"",p[4]&&(y[l]=y[l].toLowerCase());n&&(y.query=n(y.query)),r(y.port,y.protocol)||(y.host=y.hostname,y.port=""),y.username=y.password="",y.auth&&(p=y.auth.split(":"),y.username=p[0]||"",y.password=p[1]||""),y.href=y.toString()}u.prototype.set=function(t,e,n){var i=this;return"query"===t?("string"==typeof e&&e.length&&(e=(n||o.parse)(e)),i[t]=e):"port"===t?(i[t]=e,r(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="")):"hostname"===t?(i[t]=e,i.port&&(e+=":"+i.port),i.host=e):"host"===t?(i[t]=e,/\:\d+/.test(e)&&(e=e.split(":"),i.hostname=e[0],i.port=e[1])):"protocol"===t?(i.protocol=e,i.slashes=!n):i[t]=e,i.href=i.toString(),i},u.prototype.toString=function(t){t&&"function"==typeof t||(t=o.stringify);var e,n=this,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var i=r+(n.slashes?"//":"");return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.hostname,n.port&&(i+=":"+n.port),i+=n.pathname,(e="object"==typeof n.query?t(n.query):n.query)&&(i+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(i+=n.hash),i},u.qs=o,u.location=i,e.exports=u},{"./lolcation":12,querystringify:6,"requires-port":9}],12:[function(t,e,n){(function(n){"use strict";var r,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o={hash:1,query:1};e.exports=function(e){e=e||n.location||{},r=r||t("./");var s,c={},a=typeof e;if("blob:"===e.protocol)c=new r(unescape(e.pathname),{});else if("string"===a)for(s in c=new r(e,{}),o)delete c[s];else if("object"===a){for(s in e)s in o||(c[s]=e[s]);void 0===c.slashes&&(c.slashes=i.test(e.href))}return c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":11}],13:[function(t,e,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},c=0,a=0;function u(t){var e="";do{e=i[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function f(){var t=u(+new Date);return t!==r?(c=0,r=t):t+"."+u(c++)}for(;a<o;a++)s[i[a]]=a;f.encode=u,f.decode=function(t){var e=0;for(a=0;a<t.length;a++)e=e*o+s[t.charAt(a)];return e},e.exports=f},{}],14:[function(t,e,n){"use strict";var r,i,o=t("eventemitter3"),s=t("tick-tock"),c=t("recovery"),a=t("querystringify"),u=t("demolish"),f=t("yeast"),p=/\u2028/g,h=/\u2029/g;function l(t,e){if(!(t instanceof m)){var n=new Error("Primus#"+e+"'s context should called with a Primus instance");if("function"!=typeof t.listeners||!t.listeners("error").length)throw n;t.emit("error",n)}}try{r=location.origin?location.origin:location.protocol+"//"+location.host}catch(t){r="http://127.0.0.1"}function m(t,e){if(!(this instanceof m))return new m(t,e);if("function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));"object"==typeof t?t=(e=t).url||e.uri||r:e=e||{};var n=this;n.join=function(t,e){n.send("join",t,e)},n.leave=function(t,e){n.send("leave",t,e)},e.queueSize="queueSize"in e?e.queueSize:1/0,e.timeout="timeout"in e?e.timeout:1e4,e.reconnect="reconnect"in e?e.reconnect:{},e.ping="ping"in e?e.ping:25e3,e.pong="pong"in e?e.pong:1e4,e.strategy="strategy"in e?e.strategy:[],e.transport="transport"in e?e.transport:{},n.buffer=[],n.writable=!0,n.readable=!0,n.url=n.parse(t||r),n.readyState=m.CLOSED,n.options=e,n.timers=new s(this),n.socket=null,n.latency=0,n.disconnect=!1,n.transport=e.transport,n.transformers={outgoing:[],incoming:[]},n.recovery=new c(e.reconnect),"string"==typeof e.strategy&&(e.strategy=e.strategy.split(/\s?\,\s?/g)),!1===e.strategy?e.strategy=[]:e.strategy.length||(e.strategy.push("disconnect","online"),this.authorization||e.strategy.push("timeout")),e.strategy=e.strategy.join(",").toLowerCase(),"websockets"in e&&(n.AVOID_WEBSOCKETS=!e.websockets),"network"in e&&(n.NETWORK_EVENTS=e.network),e.manual||n.timers.setTimeout("open",function(){n.timers.clear("open"),n.open()},0),n.initialise(e)}m.requires=m.require=function(e){if("function"==typeof t)return t(e)};try{m.Stream=i=m.requires("stream"),m.requires("util").inherits(m,i)}catch(t){m.Stream=o,m.prototype=new o}m.OPENING=1,m.CLOSED=2,m.OPEN=3,m.prototype.AVOID_WEBSOCKETS=!1,m.prototype.NETWORK_EVENTS=!1,m.prototype.online=!0;try{(m.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(m.prototype.online=!1))}catch(t){}if(m.prototype.ark={},m.prototype.emits=t("emits"),m.prototype.plugin=function(t){if(l(this,"plugin"),t)return this.ark[t];var e={};for(t in this.ark)e[t]=this.ark[t];return e},(m.prototype.reserved=function(t){return/^(incoming|outgoing)::/.test(t)||t in this.reserved.events}).events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,online:1,error:1,close:1,open:1,data:1,end:1},m.prototype.initialise=function(t){var e,n=this;for(var r in n.recovery.on("reconnected",n.emits("reconnected")).on("reconnect failed",n.emits("reconnect failed",function(t){n.emit("end"),t()})).on("reconnect timeout",n.emits("reconnect timeout")).on("reconnect scheduled",n.emits("reconnect scheduled")).on("reconnect",n.emits("reconnect",function(t){n.emit("outgoing::reconnect"),t()})),n.on("outgoing::open",function(){var t=n.readyState;n.readyState=m.OPENING,t!==n.readyState&&n.emit("readyStateChange","opening"),e=+new Date}),n.on("incoming::open",function(){var t=n.readyState;if(n.recovery.reconnecting()&&n.recovery.reconnected(),n.writable=!0,n.readable=!0,n.online||(n.online=!0,n.emit("online")),n.readyState=m.OPEN,t!==n.readyState&&n.emit("readyStateChange","open"),n.latency=+new Date-e,n.timers.clear("ping","pong"),n.heartbeat(),n.buffer.length){var r=n.buffer.slice(),i=r.length,o=0;for(n.buffer.length=0;o<i;o++)n._write(r[o])}n.emit("open")}),n.on("incoming::pong",function(t){n.online=!0,n.timers.clear("pong"),n.heartbeat(),n.latency=+new Date-t}),n.on("incoming::error",function(t){var e=n.timers.active("connect"),r=t;if("string"==typeof t)r=new Error(t);else if(!(t instanceof Error)&&"object"==typeof t)for(var i in r=new Error(t.message||t.reason),t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i]);if(n.recovery.reconnecting())return n.recovery.reconnected(r);n.listeners("error").length&&n.emit("error",r),e&&(~n.options.strategy.indexOf("timeout")?n.recovery.reconnect():n.end())}),n.on("incoming::data",function(t){n.decoder(t,function(e,r){if(e)return n.listeners("error").length&&n.emit("error",e);n.protocol(r)||n.transforms(n,n,"incoming",r,t)})}),n.on("incoming::end",function(){var t=n.readyState;return n.disconnect?(n.disconnect=!1,n.end()):(n.readyState=m.CLOSED,t!==n.readyState&&n.emit("readyStateChange","end"),n.timers.active("connect")&&n.end(),t!==m.OPEN?!!n.recovery.reconnecting()&&n.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),n.emit("close"),~n.options.strategy.indexOf("disconnect")?n.recovery.reconnect():(n.emit("outgoing::end"),void n.emit("end"))))}),n.client(),n.ark)n.ark[r].call(n,n,t);return n.NETWORK_EVENTS?(n.offlineHandler=function(){n.online&&(n.online=!1,n.emit("offline"),n.end(),n.recovery.reset())},n.onlineHandler=function(){n.online||(n.online=!0,n.emit("online"),~n.options.strategy.indexOf("online")&&n.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",n.offlineHandler,!1),window.addEventListener("online",n.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",n.offlineHandler),document.body.attachEvent("ononline",n.onlineHandler)),n):n},m.prototype.protocol=function(t){if("string"!=typeof t||0!==t.indexOf("primus::"))return!1;var e=t.indexOf(":",8),n=t.slice(e+2);switch(t.slice(8,e)){case"pong":this.emit("incoming::pong",+n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},m.prototype.transforms=function(t,e,n,r,i){var o={data:r},s=t.transformers[n];return function t(n,r){var i=s[n++];if(!i)return r();if(1===i.length){if(!1===i.call(e,o))return;return t(n,r)}i.call(e,o,function(i,o){if(i)return e.emit("error",i);!1!==o&&t(n,r)})}(0,function(){if("incoming"===n)return e.emit("data",o.data,i);e._write(o.data)}),this},m.prototype.id=function(t){return this.socket&&this.socket.id?t(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",t))},m.prototype.open=function(){return l(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},m.prototype.write=function(t){return l(this,"write"),this.transforms(this,this,"outgoing",t),!0},m.prototype._write=function(t){var e=this;return m.OPEN!==e.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(t),!1):(e.encoder(t,function(t,n){if(t)return e.listeners("error").length&&e.emit("error",t);"string"==typeof n&&(~n.indexOf("\u2028")&&(n=n.replace(p,"\\u2028")),~n.indexOf("\u2029")&&(n=n.replace(h,"\\u2029"))),e.emit("outgoing::data",n)}),!0)},m.prototype.heartbeat=function(){var t=this;if(!t.options.ping)return t;function e(){t.timers.clear("pong"),t.online&&(t.online=!1,t.emit("offline"),t.emit("incoming::end"))}return t.timers.setTimeout("ping",function(){var n=+new Date;t.timers.clear("ping"),t._write("primus::ping::"+n),t.emit("outgoing::ping",n),t.timers.setTimeout("pong",e,t.options.pong)},t.options.ping),this},m.prototype.timeout=function(){var t=this;function e(){t.removeListener("error",e).removeListener("open",e).removeListener("end",e).timers.clear("connect")}return t.timers.setTimeout("connect",function(){e(),t.readyState===m.OPEN||t.recovery.reconnecting()||(t.emit("timeout"),~t.options.strategy.indexOf("timeout")?t.recovery.reconnect():t.end())},t.options.timeout),t.on("error",e).on("open",e).on("end",e)},m.prototype.end=function(t){if(l(this,"end"),this.readyState===m.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==t&&this.write(t),this.writable=!1,this.readable=!1;var e=this.readyState;return this.readyState=m.CLOSED,e!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},m.prototype.destroy=u("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),m.prototype.clone=function(t){return this.merge({},t)},m.prototype.merge=function(t){for(var e,n,r=1;r<arguments.length;r++)for(e in n=arguments[r])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},m.prototype.parse=t("url-parse"),m.prototype.querystring=a.parse,m.prototype.querystringify=a.stringify,m.prototype.uri=function(t){var e=this.url,n=[],r=!1;t.query&&(r=!0),(t=t||{}).protocol="protocol"in t?t.protocol:"http:",t.query=!(!e.query||!r)&&e.query.slice(1),t.secure="secure"in t?t.secure:"https:"===e.protocol||"wss:"===e.protocol,t.auth="auth"in t?t.auth:e.auth,t.pathname="pathname"in t?t.pathname:this.pathname,t.port="port"in t?+t.port:+e.port||(t.secure?443:80),this.emit("outgoing::url",t);var i=this.querystring(t.query||"");return i._primuscb=f(),t.query=this.querystringify(i),n.push(t.secure?t.protocol.replace(":","s:"):t.protocol,""),n.push(t.auth?t.auth+"@"+e.host:e.host),t.pathname&&n.push(t.pathname.slice(1)),r?n[n.length-1]+="?"+t.query:delete t.query,t.object?t:n.join("/")},m.prototype.transform=function(t,e){return l(this,"transform"),t in this.transformers?(this.transformers[t].push(e),this):this.critical(new Error("Invalid transformer type"))},m.prototype.critical=function(t){if(this.listeners("error").length)return this.emit("error",t),this;throw t},m.connect=function(t,e){return new m(t,e)},m.EventEmitter=o,m.prototype.client=function(){var t,e=this,n=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return m.requires("ws")}catch(t){}}();if(!n)return e.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));e.on("outgoing::open",function(){e.emit("outgoing::end");try{var r="ws+unix:"===e.url.protocol?"ws+unix:":"ws:",i="ws:"===r;3===n.length?e.socket=t=new n(e.uri({protocol:r,query:i}),[],e.transport):(e.socket=t=new n(e.uri({protocol:r,query:i})),t.binaryType="arraybuffer")}catch(t){return e.emit("error",t)}t.onopen=e.emits("incoming::open"),t.onerror=e.emits("incoming::error"),t.onclose=e.emits("incoming::end"),t.onmessage=e.emits("incoming::data",function(t,e){t(void 0,e.data)})}),e.on("outgoing::data",function(r){if(t&&t.readyState===n.OPEN)try{t.send(r)}catch(t){e.emit("incoming::error",t)}}),e.on("outgoing::reconnect",function(){e.emit("outgoing::open")}),e.on("outgoing::end",function(){t&&(t.onerror=t.onopen=t.onclose=t.onmessage=function(){},t.close(),t=null)})},m.prototype.authorization=!0,m.prototype.pathname="/primus",m.prototype.encoder=function(t,e){var n;try{t=JSON.stringify(t)}catch(t){n=t}e(n,t)},m.prototype.decoder=function(t,e){var n;if("string"!=typeof t)return e(n,t);try{t=JSON.parse(t)}catch(t){n=t}e(n,t)},m.prototype.version="5.2.2","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault&&t.preventDefault()},!1);var d=(navigator.userAgent||"").toLowerCase(),y=d.match(/.+(?:rv|it|ra|ie)[\/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],v=+[y[1],y[2]].join(".");!~d.indexOf("chrome")&&~d.indexOf("safari")&&v<534.54&&(m.prototype.AVOID_WEBSOCKETS=!0)}e.exports=m},{demolish:1,emits:2,eventemitter3:3,querystringify:6,recovery:7,"tick-tock":10,"url-parse":11,yeast:13}]},{},[14])(14);return t.prototype.ark.emitter=function(){},t}).call(e);for(var i=0;i<r.length;i++)r[i](e[t]);"undefined"!=typeof module&&module.exports?module.exports=e[t]:"function"==typeof define&&define.amd&&define(function(){return e[t]})}("Primus",this||{},0,[function(t){!function(t,e){function n(t,e){"use strict";var n=t.prototype.initialise;function r(t,e,n){return/^(newListener|removeListener)/.test(t)?this:(this.emitter.send.apply(this.emitter,arguments),this)}t.prototype.initialise=function(){this.emitter||(this.emitter=new e(this)),this.__initialise||n.apply(this,arguments)},t.readable?t.prototype.send||t.readable("send",r):t.prototype.send=r}function r(){"use strict";var t=Object.prototype.toString,e=Array.prototype.slice,n=Array.isArray||function(e){return"[object Array]"===t.call(e)},r={EVENT:0,ACK:1};function i(t){if(!(this instanceof i))return new i(t);this.ids=1,this.acks={},this.conn=t,this.conn&&this.bind()}return i.prototype.bind=function(){var t=this;return this.conn.on("data",function(e){t.ondata.call(t,e)}),this},i.prototype.ondata=function(t){if(!n(t.data)||t.id&&"number"!=typeof t.id)return this;switch(t.type){case r.EVENT:this.onevent(t);break;case r.ACK:this.onack(t)}return this},i.prototype.send=function(){var t=e.call(arguments);return this.conn.write(this.packet(t)),this},i.prototype.packet=function(t){var e={type:r.EVENT,data:t};if("function"==typeof t[t.length-1]){var n=this.ids++;this.acks[n]=t.pop(),e.id=n}return e},i.prototype.onevent=function(t){var e=t.data;return this.conn.reserved(e[0])?this:(t.id&&e.push(this.ack(t.id)),this.conn.emit.apply(this.conn,e),this)},i.prototype.ack=function(t){var n=this.conn,i=!1;return function(){i||(i=!0,n.write({id:t,type:r.ACK,data:e.call(arguments)}))}},i.prototype.onack=function(t){var e=this.acks[t.id];return"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id]),this},i.packets=r,i}void 0!==t&&(t.$=t.$||{},t.$.emitter={},t.$.emitter.spark=n,t.$.emitter.emitter=r,n(t,r()))}(t)}]);